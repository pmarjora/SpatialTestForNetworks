\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{hyperref}
\hypersetup{
            pdftitle={SpatialTests},
            pdfauthor={Paul M},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{SpatialTests}
\author{Paul M}
\date{11/17/2020}

\begin{document}
\maketitle

Playing around with cluster detection on networks

Load some packages

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"RColorBrewer"}\NormalTok{) }
\KeywordTok{library}\NormalTok{(}\StringTok{"png"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"ggraph"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggplot2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"networkD3"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"animation"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"maps"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(}\StringTok{"geosphere"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"RColorBrewer"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Globals\ldots{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{59}\NormalTok{)}
\NormalTok{SizeOfOurNetwork <-}\StringTok{ }\DecValTok{50}
\NormalTok{ProbOfAVertex <-}\StringTok{ }\FloatTok{0.1}
\end{Highlighting}
\end{Shaded}

Build a random network

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RandomEdges <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{ (x)\{}
\NormalTok{  x <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{)}\OperatorTok{<}\NormalTok{ProbOfAVertex}
  \KeywordTok{return}\NormalTok{ (x)}
\NormalTok{\}}

\NormalTok{RemoveSelfLoops <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}
  \ControlFlowTok{if}\NormalTok{ (x[}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{x[}\DecValTok{2}\NormalTok{])  x[}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\DecValTok{0}
  \KeywordTok{return}\NormalTok{ (x)}
\NormalTok{\}}

\NormalTok{BuildRandomNetwork <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(NetSize)\{}
\NormalTok{  MyNodes <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,SizeOfOurNetwork)}

\NormalTok{  x <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, SizeOfOurNetwork)}
\NormalTok{  y <-}\StringTok{ }\NormalTok{x}
  
\NormalTok{  MyEdges <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y)}
  \CommentTok{# make it undirected}
\NormalTok{  MyEdges2 <-}\StringTok{ }\NormalTok{MyEdges[MyEdges[,}\DecValTok{1}\NormalTok{]}\OperatorTok{<}\NormalTok{MyEdges[,}\DecValTok{2}\NormalTok{],]}

\NormalTok{  EdgePresent <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{length}\NormalTok{(MyEdges2[,}\DecValTok{1}\NormalTok{]))}
\NormalTok{  EdgePresent <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(EdgePresent),}\DataTypeTok{MARGIN=}\DecValTok{1}\NormalTok{,}\DataTypeTok{FUN=}\NormalTok{RandomEdges)}

\NormalTok{  MyEdges3 <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(MyEdges2,EdgePresent)}
  
\NormalTok{  MyEdges4 <-}\StringTok{ }\NormalTok{MyEdges3[MyEdges3[,}\DecValTok{3}\NormalTok{]}\OperatorTok{==}\DecValTok{1}\NormalTok{,]}

\NormalTok{  ThisNetwork <-}\StringTok{ }\KeywordTok{graph_from_data_frame}\NormalTok{(}\DataTypeTok{d=}\KeywordTok{as.data.frame}\NormalTok{(MyEdges4),}\DataTypeTok{vertices=}\KeywordTok{as.data.frame}\NormalTok{(MyNodes), }\DataTypeTok{directed=}\NormalTok{F) }
  
  \KeywordTok{return}\NormalTok{ (ThisNetwork)}
\NormalTok{\}}




\CommentTok{# make it undirected}
\CommentTok{#MyEdges2 <- MyEdges[MyEdges[,1]<MyEdges[,2],]}
\CommentTok{# remove self-self edges}
\CommentTok{#MyEdges3 <- t(apply(MyEdges,MARGIN=1,FUN=RemoveSelfLoops))}
\CommentTok{# remove missing edges}
\end{Highlighting}
\end{Shaded}

Plot the network using the igraph library

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"igraph"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'igraph'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     decompose, spectrum
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:base':
## 
##     union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#net <- graph_from_data_frame(d=as.data.frame(MyEdges4),vertices=as.data.frame(MyNodes), directed=F) }

\NormalTok{net <-}\StringTok{ }\KeywordTok{BuildRandomNetwork}\NormalTok{(SizeOfOurNetwork)}
\KeywordTok{class}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "igraph"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{net }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 21ec4ae UN-- 50 128 -- 
## + attr: name (v/c), EdgePresent (e/l)
## + edges from 21ec4ae (vertex names):
##  [1] 1 --2  4 --5  6 --9  7 --9  10--12 4 --13 6 --13 2 --14 11--14 6 --15
## [11] 7 --15 10--15 5 --16 9 --16 10--17 12--17 10--18 4 --19 9 --19 17--19
## [21] 3 --20 5 --20 6 --21 7 --21 11--21 12--21 20--21 12--22 3 --23 18--23
## [31] 3 --25 6 --25 9 --25 16--25 1 --26 3 --26 6 --26 12--26 5 --27 7 --27
## [41] 10--27 23--27 5 --28 9 --28 24--28 5 --29 19--29 16--30 7 --31 15--32
## [51] 21--32 23--32 27--32 11--34 12--34 14--34 15--34 19--34 23--34 27--34
## [61] 30--34 6 --35 13--35 25--35 6 --36 20--36 28--36 35--36 3 --37 11--37
## [71] 18--37 23--37 30--37 32--37 33--37 5 --38 36--38 4 --39 9 --39 11--39
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(net) }
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/plot-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# there are all sorts of pretty options}
\KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{edge.arrow.size=}\NormalTok{.}\DecValTok{2}\NormalTok{, }\DataTypeTok{edge.curved=}\DecValTok{0}\NormalTok{,}
     \DataTypeTok{vertex.color=}\StringTok{"cyan"}\NormalTok{, }\DataTypeTok{vertex.frame.color=}\StringTok{"#555555"}\NormalTok{,}
     \DataTypeTok{vertex.label.cex=}\NormalTok{.}\DecValTok{7}\NormalTok{,}\DataTypeTok{vertex.size=}\DecValTok{20}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/plot-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Compute node degrees (#links) and use that to set node size:}
\CommentTok{#deg <- degree(net)}
\KeywordTok{sum}\NormalTok{(}\KeywordTok{E}\NormalTok{(net)}\OperatorTok{==}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{size <-}\StringTok{ }\DecValTok{20} \CommentTok{#deg*3}
\NormalTok{l <-}\StringTok{ }\KeywordTok{layout_with_fr}\NormalTok{(net)}
\KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{layout=}\NormalTok{l, }\DataTypeTok{vertex.color=}\StringTok{"cyan"}\NormalTok{,)}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/plot-3.pdf}

Edges, vertices and entire mx can be accessed as follows: (nice tutorial
at
\url{https://kateto.net/wp-content/uploads/2016/01/NetSciX_2016_Workshop.pdf})

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{E}\NormalTok{(net)}
\KeywordTok{V}\NormalTok{(net)}
\NormalTok{net[]}
\end{Highlighting}
\end{Shaded}

Add attributes to the network, vertices, or edges as follows

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#for (i in 1:length(V(net)))}
  \KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(net)),}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\KeywordTok{vertex_attr}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $name
##  [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" "14" "15"
## [16] "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26" "27" "28" "29" "30"
## [31] "31" "32" "33" "34" "35" "36" "37" "38" "39" "40" "41" "42" "43" "44" "45"
## [46] "46" "47" "48" "49" "50"
## 
## $size
##  [1] 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
## [26] 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
## 
## $MyAttribute
##  [1] 0.62142123 0.39171820 0.15993370 0.93921735 0.77674530 0.64197739
##  [7] 0.83775100 0.97208245 0.82239398 0.04631028 0.75663279 0.17564456
## [13] 0.41784904 0.43202541 0.84801722 0.48979420 0.57693994 0.65177052
## [19] 0.42428145 0.71628304 0.05866973 0.86320438 0.96091629 0.23732653
## [25] 0.32370150 0.97180683 0.25964496 0.46175747 0.12019717 0.19866157
## [31] 0.82439383 0.60550093 0.27581735 0.06621377 0.19043844 0.84035394
## [37] 0.01074470 0.48382214 0.56605970 0.21935250 0.84309535 0.41517321
## [43] 0.26702041 0.75604138 0.71113138 0.94469601 0.45006495 0.60665013
## [49] 0.52786044 0.21696687
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{edge.arrow.size=}\NormalTok{.}\DecValTok{5}\NormalTok{, }\DataTypeTok{vertex.label.color=}\StringTok{"black"}\NormalTok{, }\DataTypeTok{vertex.label.dist=}\FloatTok{1.5}\NormalTok{,}
\DataTypeTok{vertex.size=}\DecValTok{4}\OperatorTok{+}\DecValTok{10}\OperatorTok{*}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute)}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/unnamed-chunk-2-1.pdf}

A network diameter is the longest geodesic distance (length of the
shortest path between two nodes) in the network. In igraph, diameter()
returns the distance, while get\_diameter() returns the nodes along the
first found path of that distance. Note that edge weights are used by
default, unless set to NA.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{diameter}\NormalTok{(net, }\DataTypeTok{directed=}\NormalTok{F, }\DataTypeTok{weights=}\OtherTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{diameter}\NormalTok{(net, }\DataTypeTok{directed=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diam <-}\StringTok{ }\KeywordTok{get_diameter}\NormalTok{(net, }\DataTypeTok{directed=}\NormalTok{F)}
\NormalTok{diam}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 6/50 vertices, named, from 21ec4ae:
## [1] 1  2  14 11 49 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{layout=}\NormalTok{l, }\DataTypeTok{vertex.color=}\StringTok{"cyan"}\NormalTok{,)}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/unnamed-chunk-3-1.pdf}

Distances between nodes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#distances(net,v=V(net)[1],to=V(net)[2])}
\CommentTok{#distances(net,v=(V(net)==9),to=(V(net)==18))}
\CommentTok{#distances(net,v=(V(net)==2),to=(V(net)==17))}
\CommentTok{#distances(net,v=V(net),to=V(net))}

\NormalTok{DM <-}\StringTok{ }\KeywordTok{distances}\NormalTok{(net,}\DataTypeTok{v=}\KeywordTok{V}\NormalTok{(net),}\DataTypeTok{to=}\KeywordTok{V}\NormalTok{(net))}
\end{Highlighting}
\end{Shaded}

Calcluating Moran's (global) I

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MoransI <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(DistanceMx, NodeAttributes)\{}
\NormalTok{  NoOfNodes <-}\StringTok{ }\KeywordTok{length}\NormalTok{(DistanceMx[}\DecValTok{1}\NormalTok{,])}
\NormalTok{  WeightSum <-}\StringTok{ }\DecValTok{0}
\NormalTok{  MoranSum <-}\StringTok{ }\DecValTok{0}
\NormalTok{  DenomSum <-}\StringTok{ }\DecValTok{0}
\NormalTok{  AttributeMean <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(NodeAttributes)}
  \CommentTok{#cat("\textbackslash{}nAttribute mean= ",AttributeMean)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{NoOfNodes)\{}
\NormalTok{    DenomSum <-}\StringTok{ }\NormalTok{DenomSum }\OperatorTok{+}\StringTok{ }\NormalTok{(NodeAttributes[i]}\OperatorTok{-}\NormalTok{AttributeMean) }\OperatorTok{*}\StringTok{ }\NormalTok{(NodeAttributes[i]}\OperatorTok{-}\NormalTok{AttributeMean) }
    \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{NoOfNodes)\{}
      \ControlFlowTok{if}\NormalTok{ ( i }\OperatorTok{!=}\StringTok{ }\NormalTok{j)\{}
\NormalTok{        ThisDist <-}\StringTok{ }\NormalTok{DistanceMx[i,j]}
        \ControlFlowTok{if}\NormalTok{ (ThisDist }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\CommentTok{# neighbors only}
\NormalTok{        \{}
\NormalTok{          WeightSum <-}\StringTok{ }\NormalTok{WeightSum }\OperatorTok{+}\StringTok{ }\NormalTok{ThisDist}
\NormalTok{          MoranSum <-}\StringTok{ }\NormalTok{ThisDist }\OperatorTok{*}\StringTok{ }\NormalTok{(NodeAttributes[i]}\OperatorTok{-}\NormalTok{AttributeMean) }\OperatorTok{*}\StringTok{ }\NormalTok{(NodeAttributes[j]}\OperatorTok{-}\NormalTok{AttributeMean)}
\NormalTok{        \}}
        \CommentTok{# V(net)$MyAttribute}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{  MoransI <-}\StringTok{ }\NormalTok{NoOfNodes }\OperatorTok{*}\StringTok{ }\NormalTok{MoranSum }\OperatorTok{/}\StringTok{ }\NormalTok{( DenomSum }\OperatorTok{*}\StringTok{ }\NormalTok{WeightSum)}
\NormalTok{\}}

\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Morans-I: "}\NormalTok{,}\KeywordTok{MoransI}\NormalTok{(DM,}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute),}\StringTok{"    expectation= "}\NormalTok{,}\OperatorTok{-}\DecValTok{1}\OperatorTok{/}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute)}\OperatorTok{-}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Morans-I:  -0.002780841     expectation=  -0.02040816
\end{verbatim}

Test it out\ldots{}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (k }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{)\{}
\NormalTok{  net <-}\StringTok{ }\KeywordTok{BuildRandomNetwork}\NormalTok{(SizeOfOurNetwork)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(net)))}
    \KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute[i] <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{)}
  \KeywordTok{vertex_attr}\NormalTok{(net)}
\NormalTok{  DM <-}\StringTok{ }\KeywordTok{distances}\NormalTok{(net,}\DataTypeTok{v=}\KeywordTok{V}\NormalTok{(net),}\DataTypeTok{to=}\KeywordTok{V}\NormalTok{(net))}
  \KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{edge.arrow.size=}\NormalTok{.}\DecValTok{5}\NormalTok{, }\DataTypeTok{vertex.label.color=}\StringTok{"black"}\NormalTok{, }\DataTypeTok{vertex.label.dist=}\FloatTok{1.5}\NormalTok{,}
  \DataTypeTok{vertex.size=}\DecValTok{4}\OperatorTok{+}\DecValTok{10}\OperatorTok{*}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute)}
  
  \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Morans-I: "}\NormalTok{,}\KeywordTok{MoransI}\NormalTok{(DM,}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute),}\StringTok{"    expectation= "}\NormalTok{,}\OperatorTok{-}\DecValTok{1}\OperatorTok{/}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute)}\OperatorTok{-}\DecValTok{1}\NormalTok{))}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Assessing null distributrion for Moran-s I via permutation tests

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PermutationTest <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ntwk,HowManyPermutations,WhichMeasure)}
\NormalTok{\{}
\NormalTok{  Results <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OperatorTok{-}\DecValTok{9}\NormalTok{,HowManyPermutations)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{HowManyPermutations)\{}
    \KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute,}\DataTypeTok{size=}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute),}\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{)}
    
    \ControlFlowTok{if}\NormalTok{ (WhichMeasure }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)  }\CommentTok{# global Moran's-I}
\NormalTok{    \{}
\NormalTok{      Results[i] <-}\StringTok{  }\KeywordTok{MoransI}\NormalTok{(DM,}\KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute)}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
      \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Undefined measure for permuation test. Exit."}\NormalTok{)}
      \ControlFlowTok{break}\NormalTok{;}
\NormalTok{    \}}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{ (Results)}
\NormalTok{\}}

\NormalTok{Results <-}\KeywordTok{PermutationTest}\NormalTok{(net,}\DecValTok{200}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(Results,}\DataTypeTok{breaks=}\DecValTok{20}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\KeywordTok{MoransI}\NormalTok{(DM,}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute),}\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\OperatorTok{-}\DecValTok{1}\OperatorTok{/}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(net)}\OperatorTok{$}\NormalTok{MyAttribute)}\OperatorTok{-}\DecValTok{1}\NormalTok{),}\DataTypeTok{col=}\StringTok{"seagreen"}\NormalTok{)  }\CommentTok{# the expected value for Morans-I}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/null-1.pdf}

Assigning spatially correlated node labels

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SpatiallyCorrelatedLabels1 <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ntwk,CentralNode)\{}

  \CommentTok{# label it and all its neighbors 1, and everything else 0.}
  \KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute <-}\StringTok{ }\DecValTok{0}
  \KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute[CentralNode] <-}\StringTok{ }\DecValTok{1}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{SizeOfOurNetwork)\{}
    \CommentTok{#if (distances(ntwk,CentralNode,i) == 1)\{}
    \CommentTok{#  V(ntwk)$MyAttribute[i] <- 1}
    \CommentTok{#\}}
    \ControlFlowTok{if}\NormalTok{ (i }\OperatorTok{!=}\StringTok{ }\NormalTok{CentralNode)\{}
      \KeywordTok{V}\NormalTok{(ntwk)}\OperatorTok{$}\NormalTok{MyAttribute[i] <-}\StringTok{ }\DecValTok{1}\OperatorTok{/}\KeywordTok{distances}\NormalTok{(ntwk,CentralNode,i)}
\NormalTok{    \}}
\NormalTok{  \} }
  \KeywordTok{return}\NormalTok{ (ntwk)}
\NormalTok{\}}

  \CommentTok{# Pick a focal node at random}
\NormalTok{  FocalNode <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(net),}\DecValTok{1}\NormalTok{)}
  \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{FocalNode: "}\NormalTok{,FocalNode)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FocalNode:  10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  newnet <-}\StringTok{ }\KeywordTok{SpatiallyCorrelatedLabels1}\NormalTok{(net,FocalNode)}
  \KeywordTok{plot}\NormalTok{(newnet, }\DataTypeTok{edge.arrow.size=}\NormalTok{.}\DecValTok{5}\NormalTok{, }\DataTypeTok{vertex.color=}\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{V}\NormalTok{(newnet)}\OperatorTok{==}\NormalTok{FocalNode,}\StringTok{"blue"}\NormalTok{,}\StringTok{"red"}\NormalTok{), }\DataTypeTok{vertex.label.dist=}\FloatTok{1.5}\NormalTok{,}
  \DataTypeTok{vertex.size=}\DecValTok{4}\OperatorTok{+}\DecValTok{10}\OperatorTok{*}\KeywordTok{V}\NormalTok{(newnet)}\OperatorTok{$}\NormalTok{MyAttribute)}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/Correlated-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Morans-I: "}\NormalTok{,}\KeywordTok{MoransI}\NormalTok{(}\KeywordTok{distances}\NormalTok{(newnet,}\DataTypeTok{v=}\KeywordTok{V}\NormalTok{(newnet),}\DataTypeTok{to=}\KeywordTok{V}\NormalTok{(newnet)),}\KeywordTok{V}\NormalTok{(newnet)}\OperatorTok{$}\NormalTok{MyAttribute),}\StringTok{"    expectation= "}\NormalTok{,}\OperatorTok{-}\DecValTok{1}\OperatorTok{/}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{V}\NormalTok{(newnet)}\OperatorTok{$}\NormalTok{MyAttribute)}\OperatorTok{-}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Morans-I:  -0.0002462202     expectation=  -0.02040816
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
  \CommentTok{# Does it look significant?}
\NormalTok{  Results2 <-}\KeywordTok{PermutationTest}\NormalTok{(newnet,}\DecValTok{500}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(Results2,}\DataTypeTok{breaks=}\DecValTok{20}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\KeywordTok{MoransI}\NormalTok{(DM,}\KeywordTok{V}\NormalTok{(newnet)}\OperatorTok{$}\NormalTok{MyAttribute),}\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{SpatialTests_files/figure-latex/Correlated-2.pdf}

Local Moran's-I (LISA). We suppose that each node has some (binary or
continuous) annotationxi, and standardize thosevalues by setting
\(z_i=x_iâˆ’\bar{x}\). The LISA measure of local clustering for each node,
\(i\), is then defined as \$ I\_i = z\_i \sum\emph{\{j \in J\_i\}
w}\{ij\}z\_j.\$ \textbackslash{} Here, \(J_i\) is the set of neighbors
of node \(i\) (although the definition can be generalized in an obvious
way), \(w_{ij}\) is a weight that is used to characterize the distance
between nodes. For example, the weight might measure the number of edges
on the shortest path between nodes \(i\) and \(j\).

\begin{itemize}
\tightlist
\item
  Random Other things
\end{itemize}

Node degrees The function degree() has a mode of in for in-degree, out
for out-degree, and all or total for total degree.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{deg <-}\StringTok{ }\KeywordTok{degree}\NormalTok{(net, }\DataTypeTok{mode=}\StringTok{"all"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(net, }\DataTypeTok{vertex.size=}\NormalTok{deg}\OperatorTok{*}\DecValTok{2}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(deg, }\DataTypeTok{breaks=}\DecValTok{1}\OperatorTok{:}\KeywordTok{vcount}\NormalTok{(net)}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Histogram of node degree"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Erdos-Renyi random graph model (???n??? is number of nodes, ???m??? is
the number of edges).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{er <-}\StringTok{ }\KeywordTok{sample_gnm}\NormalTok{(}\DataTypeTok{n=}\DecValTok{100}\NormalTok{, }\DataTypeTok{m=}\DecValTok{200}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(er, }\DataTypeTok{vertex.size=}\DecValTok{6}\NormalTok{, }\DataTypeTok{vertex.label=}\OtherTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Barabasi-Albert preferential attachment model for scale-free graphs (n
is number of nodes, power is the power of attachment (1 is linear); m is
the number of edges added on each time step)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ba <-}\StringTok{ }\KeywordTok{sample_pa}\NormalTok{(}\DataTypeTok{n=}\DecValTok{100}\NormalTok{, }\DataTypeTok{power=}\DecValTok{1}\NormalTok{, }\DataTypeTok{m=}\DecValTok{1}\NormalTok{, }\DataTypeTok{directed=}\NormalTok{F)}
\KeywordTok{plot}\NormalTok{(ba, }\DataTypeTok{vertex.size=}\DecValTok{6}\NormalTok{, }\DataTypeTok{vertex.label=}\OtherTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Rewiring a graph each\_edge() is a rewiring method that changes the edge
endpoints uniformly randomly with a probability prob.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{((}\DecValTok{876}\NormalTok{))}
\NormalTok{ba.rewired <-}\StringTok{ }\KeywordTok{rewire}\NormalTok{(ba, }\KeywordTok{each_edge}\NormalTok{(}\DataTypeTok{prob=}\FloatTok{0.1}\NormalTok{))}
\NormalTok{lay <-}\StringTok{ }\KeywordTok{layout_with_fr}\NormalTok{(ba.rewired)}
\KeywordTok{plot}\NormalTok{(ba.rewired, }\DataTypeTok{vertex.size=}\DecValTok{10}\NormalTok{, }\DataTypeTok{vertex.label=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{vertex.color=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(ba.rewired, }\DataTypeTok{vertex.size=}\DecValTok{10}\NormalTok{, }\DataTypeTok{vertex.label=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{vertex.color=}\StringTok{"blue"}\NormalTok{,}\DataTypeTok{layout=}\NormalTok{lay)}
\end{Highlighting}
\end{Shaded}

\end{document}
